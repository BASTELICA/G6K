(function(n){n.fn.autoComplete=function(t){var i=n.extend({},n.fn.autoComplete.defaults,t);return typeof t=="string"?(this.each(function(){var r=n(this);t=="destroy"?(n(window).off("resize.autocomplete",r.updateSC),r.off("blur.autocomplete focus.autocomplete keydown.autocomplete keyup.autocomplete"),r.data("autocomplete")?r.attr("autocomplete",r.data("autocomplete")):r.removeAttr("autocomplete"),n(r.data("sc")).remove(),r.removeData("sc").removeData("autocomplete")):t=="clearSuggestions"&&(r.val(""),r.last_val="\n",setTimeout(function(){r.focus()},i.delay+360))}),this):this.each(function(){function e(r){var e=t.val(),f,u,o;if(t.cache[e]=r,f=i.announce(r.length),r.length&&e.length>=i.minChars){for(t.sc.empty(),u=0;u<r.length;u++)o=n(i.renderItem(r[u],e)),o.attr({id:t.sc.attr("id")+"-suggestion-"+(u+1),role:"option",tabindex:"-1"}),t.sc.append(o);t.updateSC(0);h(f)}else h(f),r.length==0&&t.sc.html(f),t.sc.attr("aria-hidden",!0),t.sc.hide()}function h(t){var r=n("#"+i.menuId+"-announce").find("p").text();r!=t&&setTimeout(function(){n("#"+i.menuId+"-announce").html("<p>"+t+"<\/p>")},20)}function r(n){n.addClass("selected");t.val(n.data("val"));t.attr("aria-activedescendant",n.attr("id"))}function f(n,r){if(r.length&&t.sc.is(":visible")){i.onSelect(n,r.data("val"),r);setTimeout(function(){t.removeAttr("aria-activedescendant");t.sc.empty();t.sc.hide()},20)}}var t=n(this),o,u,s;if(t.sc=n("<div>",{id:i.menuId,role:"listbox","class":"autocomplete-suggestions"}),t.attr({role:"combobox","aria-owns":i.menuId,"aria-autocomplete":"both",autocorrect:"off",autocapitalize:"off",spellcheck:"false"}),i.menuClass&&t.sc.addClass(i.menuClass),t.data("sc",t.sc).data("autocomplete",t.attr("autocomplete")),t.attr("autocomplete","off"),t.cache={},t.last_val="",o=n("<div>",{id:i.menuId+"-announce","class":"sr-only","aria-live":"polite"}),t.before(o),i.clearButton){u=n("<button>",{id:i.menuId+"-clear","class":"autocomplete-input-clear-button",role:"button","aria-label":i.clearButton,title:i.clearButton});u.append('<span class="glyphicon glyphicon-remove"><\/span><\/a>');u.on("click",function(n){return n.preventDefault(),i.onClear(),t.autoComplete("clearSuggestions"),!1});t.after(u)}t.updateSC=function(r,u){var e=i.alignOnParent?t.parent():t,o,f;t.sc.css({top:e.offset().top+e.outerHeight(),left:e.offset().left,width:e.outerWidth()});r||(t.sc.show(),t.sc.removeAttr("aria-hidden"),t.sc.maxHeight||(t.sc.maxHeight=parseInt(t.sc.css("max-height"))),t.sc.suggestionHeight||(t.sc.suggestionHeight=n(".autocomplete-suggestion",t.sc).first().outerHeight()),t.sc.suggestionHeight&&(u?(o=t.sc.scrollTop(),f=u.offset().top-t.sc.offset().top,f+t.sc.suggestionHeight-t.sc.maxHeight>0?t.sc.scrollTop(f+t.sc.suggestionHeight+o-t.sc.maxHeight):f<0&&t.sc.scrollTop(f+o)):t.sc.scrollTop(0)))};n(window).on("resize.autocomplete",t.updateSC);t.sc.appendTo("body");i.helpText&&(s=n("<p>",{id:t.sc.attr("id")+"-help","class":"sr-only",text:i.helpText}),t.before(s),t.attr("aria-describedby",t.sc.attr("id")+"-help"));t.sc.on("mouseleave",".autocomplete-suggestion",function(){n(".autocomplete-suggestion.selected").removeClass("selected");t.removeAttr("aria-activedescendant")});t.sc.on("mouseenter",".autocomplete-suggestion",function(){n(".autocomplete-suggestion.selected").removeClass("selected");n(this).addClass("selected");t.attr("aria-activedescendant",n(this).attr("id"))});t.sc.on("mousedown click",".autocomplete-suggestion",function(r){var u=n(this),f=u.data("val");if(f||u.hasClass("autocomplete-suggestion")){t.val(f);i.onSelect(r,f,u);setTimeout(function(){t.sc.hide()},20);t.focus()}return!1});t.on("blur.autocomplete",function(){try{over_sb=n(".autocomplete-suggestions:hover").length}catch(i){over_sb=0}over_sb?t.is(":focus")||setTimeout(function(){t.focus()},20):(t.last_val=t.val(),t.sc.hide(),setTimeout(function(){t.sc.hide()},350))});if(!i.minChars)t.on("focus.autocomplete",function(){t.last_val="\n";t.trigger("keyup.autocomplete")});t.on("keydown.autocomplete",function(u){var e,o;if(u.which==40&&t.sc.html())return o=n(".autocomplete-suggestion.selected",t.sc),o.length?(e=o.next(".autocomplete-suggestion"),o.removeClass("selected"),e.length?r(e):(e=n(".autocomplete-suggestion",t.sc).first(),r(e))):(e=n(".autocomplete-suggestion",t.sc).first(),r(e)),t.updateSC(0,e),!1;if(u.which==38&&t.sc.html())return o=n(".autocomplete-suggestion.selected",t.sc),o.length?(e=o.prev(".autocomplete-suggestion"),o.removeClass("selected"),e.length?r(e):(e=n(".autocomplete-suggestion",t.sc).last(),r(e))):(e=n(".autocomplete-suggestion",t.sc).last(),r(e)),t.updateSC(0,e),!1;if(u.which==27)t.val(t.last_val).sc.hide(),t.focus();else if(u.which==13)o=n(".autocomplete-suggestion.selected",t.sc),f(u,o);else if(u.which==9)if(t.sc.html())if(u.shiftKey)if(o=n(".autocomplete-suggestion.selected",t.sc),o.length){if(e=o.prev(".autocomplete-suggestion"),o.removeClass("selected"),e.length)return r(e),t.updateSC(0,e),!1;u.preventDefault();f(u,o);t.last_val=t.val();t.removeAttr("aria-activedescendant");setTimeout(function(){t.sc.empty();t.focus()},300)}else return e=n(".autocomplete-suggestion",t.sc).last(),r(e),t.updateSC(0,e),!1;else if(o=n(".autocomplete-suggestion.selected",t.sc),o.length){if(e=o.next(".autocomplete-suggestion"),o.removeClass("selected"),e.length)return r(e),t.updateSC(0,e),!1;f(u,o);t.last_val=t.val();t.removeAttr("aria-activedescendant");setTimeout(function(){t.sc.empty();i.onTab()},300)}else return e=n(".autocomplete-suggestion",t.sc).first(),r(e),t.updateSC(0,e),!1;else o=n(".autocomplete-suggestion.selected",t.sc),f(u,o);else u.which==8||u.which==46?(t.sc.empty(),setTimeout(function(){t.val()==""&&i.onClear()},20)):t.val()==""&&setTimeout(function(){(t.val().length=1)&&i.onStartInput()},20)});t.on("keyup.autocomplete",function(r){var u,f,o;if(!~n.inArray(r.which,[9,13,27,35,36,37,38,39,40]))if(u=t.val(),u.length>=i.minChars){if(u!=t.last_val){if(t.last_val=u,clearTimeout(t.timer),i.cache){if(u in t.cache){e(t.cache[u]);return}for(f=1;f<u.length-i.minChars;f++)if(o=u.slice(0,u.length-f),o in t.cache&&!t.cache[o].length){e([]);return}}t.timer=setTimeout(function(){i.source(u,e)},i.delay)}}else t.last_val=u,t.sc.hide()})})};n.fn.autoComplete.defaults={source:0,minChars:3,delay:150,cache:1,alignOnParent:!1,menuId:"autocomplete-suggestions",menuClass:"",helpText:"",clearButton:"",renderItem:function(n,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var i=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+n+'">'+n.replace(i,"<b>$1<\/b>")+"<\/div>"},announce:function(n){switch(n){case 0:return"There is no suggestion";case 1:return"There is one suggestion";default:return"There are "+n+" suggestions, use up and down arrows to review."}},onSelect:function(){},onClear:function(){},onStartInput:function(){},onTab:function(){}}})(jQuery)