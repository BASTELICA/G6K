{# DO NOT EDIT THIS FILE #}

{#
The MIT License (MIT)

Copyright (c) 2015 Jacques Archimède

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is furnished
to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
#}

{% macro row(context, fieldsetContainerClass, fieldContainerClass, fieldLabelClass, fieldGroupClass, fieldClass, chapterContainerClass, chapterHeadingClass, chapterContentClass) %}

{% set step = context.step %}
{% set simu = step.simulator %}
{% set panels = 0 %}
{% set blocks = 0 %}
{%- for panel in step.panels -%}
		{%- if panel.displayable or (step.dynamic and context.script == 1) or (simu.dynamic and step.id == 0) -%}
			{% set panels = panels + 1 %}
		{% endif %}	
		{%- for blck in panel.fieldSets -%}
		{%- if blck.displayable or (step.dynamic and context.script == 1) or (simu.dynamic and step.id == 0) -%}
			{% set blocks = blocks + 1 %}
		{% endif %}
	{% endfor %}
{% endfor %}
{%- if panels > 1 %}
<ul class="nav nav-tabs">
{%- for panel in step.panels -%}
	<li{%- if loop.index == 1 %} class="active"{%- endif -%}>
		<a aria-expanded="{%- if loop.index == 1 -%}true{%- else -%}false{%- endif -%}" id="ui-tab-panel-{{ panel.id}}" role="button" data-toggle="tab" href="#{{ step.name }}-panel-{{ panel.id }}">{{ panel.label }}{%- if loop.index == 1 %}<span class="sr-only"> (actif)</span>{% endif -%}</a>
	</li>
{% endfor %}
</ul>
<div class="tab-content">
{% endif %}

{%- for panel in step.panels -%}
	{%- if panels > 1 %}
	<div id="{{ step.name }}-panel-{{ panel.id }}" class="step-panel-container tab-pane{%- if loop.index == 1 %} active{%- endif -%}">
		<h2 tabindex="-1" class="sr-only">{{ panel.label }}</h2>
	{% else %}
	<div id="{{ step.name }}-panel-{{ panel.id }}" class="step-panel-container">
	{% endif %}
	{%- if panel.hasCollapsibles %}
		<p class="collapse-expand-all-tools">
			<button class="btn">Tout replier</button>
			<button class="btn">Tout déplier</button>
		</p>
	{% endif %}
	{%- for blck in panel.fieldSets -%}
		{%- if blck.class == 'FieldSet' -%}
			{% set fieldset = blck %}
			{%- if fieldset.displayable or (step.dynamic and context.script == 1) or (simu.dynamic and step.id == 0) -%}
			<{%- if blocks > 1 and fieldset.hasInputFields -%}fieldset class="fieldset-container {{ fieldsetContainerClass }}"{% else %}div class="fieldset {{ fieldsetContainerClass }}"{% endif %} id="{{ step.name }}-panel-{{ panel.id }}-fieldset-{{ fieldset.id }}">
			{%- if fieldset.display is not empty and fieldset.display == 'pop-in' -%}
			{{ _self.popinheader(context, fieldset) }}
			{%- endif -%}
			{%- if blocks > 1  and fieldset.hasInputFields %}
				<legend>{%- if fieldset.legend is not empty -%}{{ fieldset.legend }}{%- else -%}{{ step.label }}{%- endif -%}</legend>
			{% else %}
				{%- if fieldset.legend is not empty -%}<div class="legend">{{ fieldset.legend }}</div>{%- endif -%}
			{% endif %}
			{%- if fieldset.disposition is not empty and fieldset.disposition == "grid" -%}
			<table role="presentation" class="grid" id="{{ step.name }}-panel-{{ panel.id }}-grid-{{ fieldset.id }}">
				<thead class="grid-header">
					<tr>
						<th scope="col">&nbsp;</th>
						{%- for column in fieldset.columns -%}
						<th scope="col" role="columnheader">{{ column.label }}</th>
						{% endfor %}
					</tr>
				</thead>
				<tbody role="rowgroup">
				{%- for row in fieldset.fields -%}
				{% set gid = row.dataGroup %}
				{% set datagroup = simu.dataGroupById(gid) %}
				<tr id="{{ datagroup.name }}-datagroup" role="row">
					<th scope="row" role="rowheader" rowspan="2" data-label="{{ row.label }}">{{ row.label }}</th>
					{%- for field in row.fields -%}
					{%- if field.displayable or (step.dynamic and context.script == 1) or (simu.dynamic and step.id == 0) -%}
					{% set id = field.data %}
					{% set data = simu.dataById(id) %}
					{% set type = data.type %}
					{% set name = data.name %}
					{% set value = data.value %}
					{% set prompt = field.prompt ? field.prompt : '---------' %}
					{%- if type == 'money' or type == 'percent' -%}
						{% set value = value|replace(".", ",") %}
					{% elseif type == 'number' %}
					{% elseif type == 'integer' %}
						{% set type = 'number' %}
					{% endif %}
					{%- if field.usage == 'input' -%}
					<td data-label="{{ fieldset.columns[loop.index0].label }}">
						<div id="{{ name }}-container" data-type="{{ type }}"{%- if type == 'choice' and field.usage == 'input' and field.expanded == 1 %} data-expanded="true"{% endif %} data-field-position="{{ field.position }}" class="field-container {{ fieldContainerClass }}">
						{%- if type == 'money' and simu.symbolPosition == 'before' %}<span class="money-symbol">{{ simu.moneySymbol }}</span> {% endif %}
						<div class="{{ fieldGroupClass }}">
							{%- if type == 'choice' -%}
								{%- if field.expanded == 1 -%}
								<div id="{{ name }}">
								{%- for choice in data.choices -%}
									{%- if choice.class == 'ChoiceGroup' -%}
									{%- for gchoice in choice.choices -%}
										{%- if gchoice.selected -%}
										<label class="choice" for="{{ name }}_{{ gchoice.id }}"><input id="{{ name }}_{{ gchoice.id }}" type="radio" name="{{ name }}" value="{{ gchoice.value }}"{%- if gchoice.value == value %} checked="checked"{% endif %} />{{ gchoice.label }}</label>
										{% endif %}
									{% endfor %}
									{%- elseif choice.class == 'Choice' and choice.selected -%}
									<label class="choice" for="{{ name }}_{{ choice.id }}"><input id="{{ name }}_{{ choice.id }}" type="radio" name="{{ name }}" value="{{ choice.value }}"{%- if choice.value == value %} checked="checked"{% endif %} />{{ choice.label }}</label>
									{% endif %}
								{% endfor %}
								</div>
								{% else %}
									<select aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }}" class="{{ fieldClass }}" id="{{ name }}" name="{{ name }}"{% if field.required %} aria-required="true"{% endif %}>
									{%- if not(data.default) -%}<option id="{{ name }}_none" value="">{{ prompt }}</option>{% endif %}
									{%- for choice in data.choices -%}
										{%- if choice.class == 'ChoiceGroup' -%}
										<optgroup label="{{ choice.label }}">
										{%- for gchoice in choice.choices -%}
											{%- if gchoice.selected -%}
											<option id="{{ name }}_{{ gchoice.id }}" value="{{ gchoice.value }}"{%- if gchoice.value == value %} selected="selected"{% endif %}>{{ gchoice.label }}</option>
											{% endif %}
										{% endfor %}
										</optgroup>
										{%- elseif choice.class == 'Choice' and choice.selected -%}
										<option id="{{ name }}_{{ choice.id }}" value="{{ choice.value }}"{%- if choice.value == value %} selected="selected"{% endif %}>{{ choice.label }}</option>
										{% endif %}
									{% endfor %}
									</select>
								{% endif %}
							{% elseif type == 'multichoice' %}
								<div id="{{ name }}">
								{%- for choice in data.choices -%}
									{%- if choice.class == 'ChoiceGroup' -%}
									{%- for gchoice in choice.choices -%}
										{%- if gchoice.selected -%}
										<label class="choice" for="{{ name }}_{{ gchoice.id }}_{{ loop.index }}"><input id="{{ name }}_{{ gchoice.id }}_{{ loop.index }}" type="checkbox" name="{{ name }}[]" value="{{ gchoice.value }}"{%- if gchoice.value in value %} checked="checked"{% endif %} />{{ gchoice.label }}</label>
										{% endif %}
									{% endfor %}
									{%- elseif choice.class == 'Choice' and choice.selected -%}
									<label class="choice" for="{{ name }}_{{ choice.id }}_{{ loop.index }}"><input id="{{ name }}_{{ choice.id }}_{{ loop.index }}" type="checkbox" name="{{ name }}[]" value="{{ choice.value }}"{%- if choice.value in value %} checked="checked"{% endif %} />{{ choice.label }}</label>
									{% endif %}
								{% endfor %}
								</div>
							{% elseif type == 'boolean' %}
								<input aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }}" class="{{ fieldClass }}" type="checkbox" id="{{ name }}" name="{{ name }}" value="true"{%- if value == 'true' %} checked="checked"{% endif %}{% if field.required %} aria-required="true"{% endif %} />
							{% elseif type == 'date' %}
								{%- if context.ua.mobile -%}
								<input type="date" aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }}" id="{{ name }}" name="{{ name }}" value="{{ value }}" class="date {{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{%- endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{%- if data.min is not empty %} min="{{ data.min }}"{% endif %}{%- if data.max is not empty %} max="{{ data.max }}"{% endif %}{% if field.required %} aria-required="true"{% endif %} />
								{% elseif context.script == 0 %}
								<input type="date" aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }}" id="{{ name }}" name="{{ name }}" value="{{ value }}" class="date {{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{%- endif %}"{%- if data.error %} aria-invalid="true"{% endif %} placeholder="jj/mm/aaaa" title="format : jj/mm/aaaa"{% if field.required %} aria-required="true"{% endif %} />
								{% else %}
								<input type="text" aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }}" id="{{ name }}" name="{{ name }}" value="{{ value }}" class="date {{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{%- endif %}"{%- if data.error %} aria-invalid="true"{% endif %} placeholder="jj/mm/aaaa"  title="format : jj/mm/aaaa"{% if field.required %} aria-required="true"{% endif %} />
								{% endif %}
							{% elseif type == 'day' %}
								{% set min = data.min ?: 01 %}
								{% set max = data.max ?: 31 %}
								<select aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }} : sélectionner le jour dans la liste déroulante" id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{%- endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								{%- if not(data.default) -%}<option value="00">--</option>{% endif %}
								{% for i in min..max %}
								<option value="{{ i }}"{%- if i == value %} selected="selected"{% endif %}>{{ i }}</option>
								{% endfor %}
								</select>
							{% elseif type == 'month' %}
								{% set min = data.min|default(01) %}
								{% set max = data.max|default(12) %}
								<select aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }} : sélectionner le mois dans la liste déroulante" id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								{%- if not(data.default) -%}<option value="00">-------------------</option>{% endif %}
								{% for i in min..max %}
								<option value="{{ i }}"{%- if value == i %} selected="selected"{% endif %}>{{ _self.monthname(i)|trans }}</option>
								{% endfor %}
								</select>
							{% elseif type == 'year' %}
								{% set min = data.min|default(1964) %}
								{% set max = data.max|default(min + 100) %}
								<select aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }} : sélectionner l'année dans la liste déroulante" id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								{%- if not(data.default) -%}<option value="">----</option>{% endif %}
								{% for i in min..max %}
								<option value="{{ i }}"{%- if i == value %} selected="selected"{% endif %}>{{ i }}</option>
								{% endfor %}
								</select>
							{% elseif type == 'region' %}
								<select aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }} : sélectionner la région dans la liste déroulante" id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{%- endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								{{ _self.regions() }}
								</select>
							{% elseif type == 'department' %}
								<select aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }} : sélectionner le département dans la liste déroulante" id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{%- endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								{{ _self.departments(value, prompt) }}
								</select>
							{% elseif type == 'textarea' %}
							<textarea aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }}" id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{%- endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>{{ value }}</textarea>
							{% elseif type == 'number' %}
							<input type="{{ type }}" aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }}" id="{{ name }}" name="{{ name }}" value="{{ value }}"{%- if data.min is not empty %} min="{{ data.min }}"{% endif %}{%- if data.max is not empty %} max="{{ data.max }}"{% endif %}{%- if data.error -%} class="has-error" aria-invalid="true"{%- elseif data.warning %} class="has-warning"{% endif %} title="format: nombre"{% if field.required %} aria-required="true"{% endif %}/>
							{% elseif type == 'percent' %}
							<input type="text" aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }}" id="{{ name }}" name="{{ name }}" value="{{ value }}"{%- if data.min is not empty %} min="{{ data.min }}"{% endif %}{%- if data.max is not empty %} max="{{ data.max }}"{% endif %}{%- if data.error -%} class="has-error" aria-invalid="true"{%- elseif data.warning %} class="has-warning"{% endif %} title="format: pourcentage"{% if field.required %} aria-required="true"{% endif %} />
							{% elseif type == 'money' %}
							<input type="{{ type }}" aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }}" id="{{ name }}" name="{{ name }}" value="{{ value }}"{%- if data.error -%} class="has-error" aria-invalid="true"{%- elseif data.warning %} class="has-warning"{% endif %} title="format: montant en euros"{% if field.required %} aria-required="true"{% endif %}/>
							{% else %}
							<input type="{{ type }}" aria-label="{{ row.label }} {{ fieldset.columns[loop.index0].label }}" id="{{ name }}" name="{{ name }}" value="{{ value }}"{%- if data.error -%} class="has-error" aria-invalid="true"{%- elseif data.warning %} class="has-warning"{% endif %}{% if field.required %} aria-required="true"{% endif %} />
							{% endif %}
						</div>
						{%- if type == 'money' and simu.symbolPosition == 'after' %}
							<span class="money-symbol">{{ simu.moneySymbol }}</span>
						{% endif %}
						{%- if type == 'percent' -%}<span class="percent-symbol">%</span>{%- endif %}
						{%- if data.unit -%}<span class="unit"> {{ data.unit }}</span>{%- endif -%}
						</div>
					</td>
					{% else %}
					<td data-label="{{ fieldset.columns[loop.index0].label }}">
						{% spaceless %}
						<span id="{{ name }}" data-type="{{ type }}" data-field-position="{{ field.position }}" class="output{%- if field.emphasized %} emphasized{%- endif -%}">{%- if type == 'money' and simu.symbolPosition == 'before' %}{{ simu.moneySymbol }} {% endif -%}
						{%- if type == 'choice' -%}
							{%- for choice in data.choices -%}
							{%- if choice.class == 'ChoiceGroup' -%}
							{%- for gchoice in choice.choices if gchoice.value == value -%}
								{{- gchoice.label|trim -}}
							{%- endfor -%}
							{%- elseif choice.class == 'Choice' and choice.value == value -%}
								{{- choice.label|trim -}}
							{%- endif -%}
							{%- endfor -%}
						{%- elseif type == 'multichoice' -%}
							{%- for choice in data.choices -%}
							{%- if choice.class == 'ChoiceGroup' -%}
							{%- for gchoice in choice.choices if gchoice.value in value -%}
								<span>{{- gchoice.label|trim -}}</span>
							{%- endfor -%}
							{%- elseif choice.class == 'Choice' and choice.value in value -%}
								<span>{{- choice.label|trim -}}</span>
							{%- endif -%}
							{%- endfor -%}
						{%- elseif type == 'boolean' -%}
							{{ value == 'true' ? 'oui' : 'non' }}
						{%- elseif type == 'month' -%}
							{{ _self.monthname(value)|trans }}
						{%- elseif type == 'department' -%}
							{{ _self.departmentname(value) }}
						{%- else -%}
							{{ value }}
						{%- endif -%}
						</span>
						{%- if type == 'money' and simu.symbolPosition == 'after' %}
							<span class="money-symbol{%- if field.emphasized %} emphasized{%- endif %}">&#xA0;{{ simu.moneySymbol }}</span>
						{%- endif -%}
						{%- if type == 'percent' -%}<span class="percent-symbol{%- if field.emphasized %} emphasized{%- endif -%}">%</span>{%- endif -%}
						{%- if data.unit -%}<span class="unit{%- if field.emphasized %} emphasized{%- endif -%}"> {{ data.unit }}</span>{%- endif -%}
						{% endspaceless %}
					</td>
					{% endif %}
				{% else %}
					<td>&nbsp;</td>
				{% endif %}
				{% endfor %}
				</tr>
				<tr>
					<td colspan="{{ row.fields|length }}">
						{%- if (step.dynamic or (simu.dynamic and step.id == 0)) -%}
						<div aria-live="polite" id="{{ datagroup.name }}-error" class="group-error{%- if datagroup.error %} has-error{%- elseif datagroup.warning %} has-warning{%- else %} hidden{%- endif -%}">{%- if datagroup.error -%}{%- for errorMessage in datagroup.errorMessages -%}<p>{{ errorMessage }}</p>{%- endfor -%}{% endif %}</div>
						{%- else -%}
						{%- if datagroup.error -%}<div aria-live="polite" id="{{ datagroup.name }}-error" class="group-error has-error">{%- for errorMessage in datagroup.errorMessages -%}<p>{{ errorMessage }}</p>{%- endfor -%}</div>{%- elseif datagroup.warning -%}<div aria-live="polite" id="{{ datagroup.name }}-error" class="group-error has-warning">{%- for warningMessage in datagroup.warningMessages -%}<p>{{ warningMessage }}</p>{%- endfor -%}</div>{% endif %}
						{% endif %}
					</td>
				</tr>
				{% endfor %}
				</tbody>
			</table>
			{% else %} {# fieldset.disposition #}
			{%- for field in fieldset.fields -%}
				{%- if field.displayable or (step.dynamic and context.script == 1) or (simu.dynamic and step.id == 0) -%}
					{% set id = field.data %}
					{% set label = field.label %}
					{% set data = simu.dataById(id) %}
					{% set type = data.type %}
					{% set name = data.name %}
					{% set value = data.value %}
					{% set prompt = field.prompt ? field.prompt : '---------' %}
					{%- if type == 'money' or type == 'percent' -%}
						{% set value = value|replace(".", ",") %}
					{% elseif type == 'number' %}
					{% elseif type == 'integer' %}
						{% set type = 'number' %}
					{% endif %}
					<div id="{{ name }}-container" data-type="{{ type }}"{%- if type == 'choice' and field.usage == 'input' and field.expanded == 1 %} data-expanded="true"{% endif %} data-field-position="{{ field.position }}" class="field-container {{ fieldContainerClass }}{%- if not(loop.first) and field.newline %} new-line{% endif %}{%- if field.underlabel == 1 %} underlabel{% endif %}">			
					{%- if field.preNote and field.preNote.displayable -%}
						<div class="pre-note">{{ _self.paragraphs(field.preNote.text) }}</div>
					{% endif %}
					{%- if field.usage == 'input' -%}
						{%- if label == '' -%}
						<span class="label">{% if field.required or field.visibleRequired %} * {% endif %}</span>
						{% elseif (type == 'choice' and field.expanded == 1) or type == 'multichoice' %}
						<label id="{{ name }}-label" class="{{ fieldLabelClass }}">{% if field.required or field.visibleRequired %}<span class="asterisk"> * </span>{% endif %}{{ label }}{% if field.required or field.visibleRequired %}<span class="asterisk"> * </span>{% endif %}{% if field.hasColon %} : {% endif %}</label>
						{% else %}
						<label id="{{ name }}-label" class="{{ fieldLabelClass }}" for="{{ name }}">{% if field.required or field.visibleRequired %}<span class="asterisk"> * </span>{% endif %}{{ label }}{% if field.required or field.visibleRequired %}<span class="asterisk"> * </span>{% endif %}{% if field.hasColon %} : {% endif %}</label>
						{% endif %}
						<div class="{{ fieldGroupClass }}">
							{%- if type == 'money' and simu.symbolPosition == 'before' %}<span class="money-symbol">{{ simu.moneySymbol }}</span> {% endif %}
							{%- if type == 'choice' -%}
								{%- if field.expanded == 1 -%}
								<fieldset id="{{ name }}">
								<legend class="sr-only">{{ label }}</legend>
								{%- for choice in data.choices -%}
									{%- if choice.class == 'ChoiceGroup' -%}
									{%- for gchoice in choice.choices -%}
										{%- if gchoice.selected -%}
										<label class="choice" for="{{ name }}_{{ gchoice.id }}"><input id="{{ name }}_{{ gchoice.id }}" type="radio" name="{{ name }}" value="{{ gchoice.value }}"{%- if gchoice.value == value %} checked="checked"{% endif %} />{{ gchoice.label }}</label>
										{% endif %}
									{% endfor %}
									{%- elseif choice.class == 'Choice' and choice.selected -%}
									<label class="choice" for="{{ name }}_{{ choice.id }}"><input id="{{ name }}_{{ choice.id }}" type="radio" name="{{ name }}" value="{{ choice.value }}"{%- if choice.value == value %} checked="checked"{% endif %} />{{ choice.label }}</label>
									{% endif %}
								{% endfor %}
								</fieldset>
								{% else %}
									<select class="{{ fieldClass }}" id="{{ name }}" name="{{ name }}"{% if field.required %} aria-required="true"{% endif %}>
									{%- if not(data.default) -%}<option id="{{ name }}_none" value="">{{ prompt }}</option>{% endif %}
									{%- for choice in data.choices -%}
										{%- if choice.class == 'ChoiceGroup' -%}
										<optgroup label="{{ choice.label }}">
										{%- for gchoice in choice.choices -%}
											{%- if gchoice.selected -%}
											<option id="{{ name }}_{{ gchoice.id }}" value="{{ gchoice.value }}"{%- if gchoice.value == value %} selected="selected"{% endif %}>{{ gchoice.label }}</option>
											{% endif %}
										{% endfor %}
										</optgroup>
										{%- elseif choice.class == 'Choice' and choice.selected -%}
										<option id="{{ name }}_{{ choice.id }}" value="{{ choice.value }}"{%- if choice.value == value %} selected="selected"{% endif %}>{{ choice.label }}</option>
										{% endif %}
									{% endfor %}
									</select>
								{% endif %}
							{% elseif type == 'multichoice' %}
								<fieldset id="{{ name }}">
								<legend class="sr-only">{{ label }}</legend>
								{%- for choice in data.choices -%}
									{%- if choice.class == 'ChoiceGroup' -%}
									{%- for gchoice in choice.choices -%}
										{%- if gchoice.selected -%}
										<label class="choice" for="{{ name }}_{{ gchoice.id }}_{{ loop.index }}"><input id="{{ name }}_{{ gchoice.id }}_{{ loop.index }}" type="checkbox" name="{{ name }}[]" value="{{ gchoice.value }}"{%- if gchoice.value in value %} checked="checked"{% endif %} />{{ gchoice.label }}</label>
										{% endif %}
									{% endfor %}
									{%- elseif choice.class == 'Choice' and choice.selected -%}
									<label class="choice" for="{{ name }}_{{ choice.id }}_{{ loop.index }}"><input id="{{ name }}_{{ choice.id }}_{{ loop.index }}" type="checkbox" name="{{ name }}[]" value="{{ choice.value }}"{%- if choice.value in value %} checked="checked"{% endif %} />{{ choice.label }}</label>
									{% endif %}
								{% endfor %}
								</fieldset>
							{% elseif type == 'boolean' %}
							<input class="{{ fieldClass }}" type="checkbox" id="{{ name }}" name="{{ name }}" value="true"{%- if value == 'true' %} checked="checked"{% endif %}{% if field.required %} aria-required="true"{% endif %} />
							{% elseif type == 'date' %}
								{%- if context.ua.mobile -%}
								<input type="date" id="{{ name }}" name="{{ name }}" value="{{ value }}" class="date {{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{%- if data.min is not empty %} min="{{ data.min }}"{% endif %}{%- if data.max is not empty %} max="{{ data.max }}"{% endif %}{% if field.required %} aria-required="true"{% endif %} />
								{% elseif context.script == 0 %}
								{#
								<div class="g6k-date">
								<legend>{{ name }}</legend>
								{% set values = value|split('/', 3) %}
								{% set day = values[0]|default('') %}
								{% set month = values[1]|default('') %}
								{% set year = values[2]|default('') %}
								<label for="{{ name }}_g6k_day">{{ 'Day'|trans }}</label>
								<select id="{{ name }}_g6k_day" name="{{ name }}_g6k_day" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								<option value="">--</option>
								{% for i in 01..31 %}
								<option value="{{ i }}"{%- if i == day %} selected="selected"{% endif %}>{{ "%02d"|format(i) }}</option>
								{% endfor %}
								</select>
								<label for="{{ name }}_g6k_month">{{ 'Month'|trans }}</label>
								<select id="{{ name }}_g6k_month" name="{{ name }}_g6k_month" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								<option value="">--</option>
								{% for i in 01..12 %}
								<option value="{{ i }}"{%- if i == month %} selected="selected"{% endif %}>{{ "%02d"|format(i) }}</option>
								{% endfor %}
								</select>
								<label for="{{ name }}_g6k_year">{{ 'Year'|trans }}</label>
								<select id="{{ name }}_g6k_year" name="{{ name }}_g6k_year" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								<option value="">----</option>
								{% for i in 1964..2064 %}
								<option value="{{ i }}"{%- if i == year %} selected="selected"{% endif %}>{{ i }}</option>
								{% endfor %}
								</select>
								</div>
								#}
								<input type="date" id="{{ name }}" name="{{ name }}" value="{{ value }}" class="date {{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %} placeholder="jj/mm/aaaa" title="format : jj/mm/aaaa"{% if field.required %} aria-required="true"{% endif %}/>
								{% else %}
								<input type="text" aria-describedby="{{ name }}-aria-description" id="{{ name }}" name="{{ name }}" value="{{ value }}" class="date {{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %} placeholder="jj/mm/aaaa" title="format : jj/mm/aaaa"{% if field.required %} aria-required="true"{% endif %} />
								<span id="{{ name }}-aria-description" class="sr-only">Saisir la date sous la forme jj/mm/aaaa ou tabuler pour activer le sélecteur de date à droite de ce champ de saisie</span>
								{% endif %}
							{% elseif type == 'day' %}
								{% set min = data.min ?: 01 %}
								{% set max = data.max ?: 31 %}
								<select id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								{%- if not(data.default) -%}<option value="00">--</option>{% endif %}
								{% for i in min..max %}
								<option value="{{ i }}"{%- if i == value %} selected="selected"{% endif %}>{{ i }}</option>
								{% endfor %}
								</select>
							{% elseif type == 'month' %}
								{% set min = data.min|default(01) %}
								{% set max = data.max|default(12) %}
								<select id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								{%- if not(data.default) -%}<option value="00">{{ prompt }}</option>{% endif %}
								{% for i in min..max %}
								<option value="{{ i }}"{%- if value == i %} selected="selected"{% endif %}>{{ _self.monthname(i)|trans }}</option>
								{% endfor %}
								</select>
							{% elseif type == 'year' %}
								{% set min = data.min|default(1964) %}
								{% set max = data.max|default(min + 100) %}
								<select id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								{%- if not(data.default) -%}<option value="">----</option>{% endif %}
								{% for i in min..max %}
								<option value="{{ i }}"{%- if i == value %} selected="selected"{% endif %}>{{ i }}</option>
								{% endfor %}
								</select>
							{% elseif type == 'region' %}
								<select id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								{{ _self.regions() }}
								</select>
							{% elseif type == 'department' %}
								<select id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>
								{{ _self.departments(value, prompt) }}
								</select>
							{% elseif type == 'textarea' %}
							<textarea id="{{ name }}" name="{{ name }}" class="{{ fieldClass }}{%- if data.error %} has-error{%- elseif data.warning %} has-warning{% endif %}"{%- if data.error %} aria-invalid="true"{% endif %}{% if field.required %} aria-required="true"{% endif %}>{{ value }}</textarea>
							{% elseif type == 'number' %}
							<input type="{{ type }}" id="{{ name }}" name="{{ name }}" value="{{ value }}"{%- if data.min is not empty %} min="{{ data.min }}"{% endif %}{%- if data.max is not empty %} max="{{ data.max }}"{% endif %}{%- if data.error -%} class="has-error" aria-invalid="true"{%- elseif data.warning %} class="has-warning"{% endif %} title="format: nombre"{% if field.required %} aria-required="true"{% endif %}/>
							{% elseif type == 'percent' %}
							<input type="text" id="{{ name }}" name="{{ name }}" value="{{ value }}"{%- if data.min is not empty %} min="{{ data.min }}"{% endif %}{%- if data.max is not empty %} max="{{ data.max }}"{% endif %}{%- if data.error -%} class="has-error" aria-invalid="true"{%- elseif data.warning %} class="has-warning"{% endif %}  title="format: pourcentage"{% if field.required %} aria-required="true"{% endif %}/>
							{% elseif type == 'money' %}
							<input type="{{ type }}" id="{{ name }}" name="{{ name }}" value="{{ value }}"{%- if data.error -%} class="has-error" aria-invalid="true"{%- elseif data.warning %} class="has-warning"{% endif %} title="format: montant en euros"{% if field.required %} aria-required="true"{% endif %} />
							{% else %}
							<input type="{{ type }}" id="{{ name }}" name="{{ name }}" value="{{ value }}"{%- if data.error -%} class="has-error" aria-invalid="true"{%- elseif data.warning %} class="has-warning"{% endif %}{% if field.required %} aria-required="true"{% endif %} />
							{% endif %}
						</div>
						{%- if type == 'money' and simu.symbolPosition == 'after' %}
							<span class="money-symbol">{{ simu.moneySymbol }}</span>
						{% endif %}
						{%- if type == 'percent' -%}<span class="percent-symbol">%</span>{%- endif %}
						{%- if data.unit -%}<span class="unit"> {{ data.unit }}</span>{%- endif -%}
					{% elseif field.usage == 'output' %}
						{%- if label is not empty -%}
							{%- if field.emphasized -%}
							<span id="{{ name }}-label" class="label emphasized">{{ label }}{% if field.hasColon %} : {% endif %}</span>
							{% else %}
							<span id="{{ name }}-label" class="label">{{ label }}{% if field.hasColon %} : {% endif %}</span>
							{%- endif -%}
						{%- endif -%}
						{%- if type == 'table' -%}
						<table id="{{ data.table.id }}" summary="{{ data.table.description }}">
							<caption>{{ data.table.label }}</caption>
							<thead>
								<tr>
								{%- for column in data.table.columns -%}
									<th id="{{ column.id }}" abbr="{{ column.name }}" scope="col">{{ column.label }}</th>
								{% endfor %}
								<tr>
							</thead>
							<tbody>
								{%- for row in data.table.rows -%}
								<tr>
									{%- for cell in row.cells -%}
									<td headers="{{ cell.column.id }}">{{ cell }}</td>
									{% endfor %}
								</tr>
								{% endfor %}
							</tbody>
						</table>
						{%- else -%}
							{% spaceless %}
							<span id="{{ name }}" class="output{%- if field.emphasized %} emphasized{%- endif -%}">{%- if type == 'money' and simu.symbolPosition == 'before' %}{{ simu.moneySymbol }} {% endif -%}
							{%- if type == 'choice' -%}
								{%- for choice in data.choices -%}
								{%- if choice.class == 'ChoiceGroup' -%}
								{%- for gchoice in choice.choices if gchoice.value == value -%}
									{{- gchoice.label|trim -}}
								{%- endfor -%}
								{%- elseif choice.class == 'Choice' and choice.value == value -%}
									{{- choice.label|trim -}}
								{%- endif -%}
								{%- endfor -%}
							{%- elseif type == 'multichoice' -%}
								{%- for choice in data.choices -%}
								{%- if choice.class == 'ChoiceGroup' -%}
								{%- for gchoice in choice.choices if gchoice.value in value -%}
									<span>{{- gchoice.label|trim -}}</span>
								{%- endfor -%}
								{%- elseif choice.class == 'Choice' and choice.value in value -%}
									<span>{{- choice.label|trim -}}</span>
								{%- endif -%}
								{%- endfor -%}
							{%- elseif type == 'boolean' -%}
								{{ value == 'true' ? 'oui' : 'non' }}
							{%- elseif type == 'month' -%}
								{{ _self.monthname(value)|trans }}
							{%- elseif type == 'department' -%}
								{{ _self.departmentname(value) }}
							{%- else -%}
								{{ value }}
							{%- endif -%}			
							</span>
							{%- if type == 'money' and simu.symbolPosition == 'after' %}
								<span class="money-symbol{%- if field.emphasized %} emphasized{%- endif %}">&#xA0;{{ simu.moneySymbol }}</span>
							{%- endif -%}
							{%- if type == 'percent' -%}<span class="percent-symbol{%- if field.emphasized %} emphasized{%- endif -%}">%</span>{%- endif -%}
							{%- if data.unit -%}<span class="unit{%- if field.emphasized %} emphasized{%- endif -%}"> {{ data.unit }}</span>{%- endif -%}
							{% endspaceless %}
						{%- endif %}
					{% endif %}
					{%- if field.hasHelp -%}
						<button type="button" data-toggle="collapse" data-target="#help-{{ name }}" aria-controls="help-{{ name }}" class="btn btn-help collapsed" title="aide sur {{ label }}"><span class="icon icon-help" aria-hidden="true"></span><span class="blank">Aide</span></button>
						{% endif %}
					{%- if (step.dynamic or (simu.dynamic and step.id == 0)) and field.usage == 'input' -%}
					<div class="field-error{%- if data.error %} has-error{%- elseif data.warning %} has-warning{%- else %} hidden{%- endif %}" aria-live="assertive">{%- if data.error -%}{%- for errorMessage in data.errorMessages -%}<p>{{ errorMessage }}</p>{%- endfor -%}{%- endif -%}</div>
					{%- else -%}
					{%- if data.error -%}<div class="field-error has-error" aria-live="assertive">{%- for errorMessage in data.errorMessages -%}<p>{{ errorMessage }}</p>{%- endfor -%}</div>{%- elseif data.warning -%}<div class="field-error has-warning" aria-live="assertive">{%- for warningMessage in data.warningMessages -%}<p>{{ warningMessage }}</p>{%- endfor -%}</div>{% endif %}
					{% endif %}
					{%- if field.explanation is not empty -%}
						<span id="{{ name }}-explanation" class="explanation">{{ field.explanation }}</span>
					{% endif %}
					{%- if field.postNote and field.postNote.displayable -%}
						<div class="post-note">{{ _self.paragraphs(field.postNote.text) }}</div>
					{% endif %}
					{%- if field.hasHelp %}
						{% set paragraphs = data.description|trim|split("\n") %}
						<div class="collapse help-panel" id="help-{{ name }}">
						<dl>
						<dt>aide sur {{ label }}</dt>
						<dd>
						{%- for paragraph in paragraphs -%}
							<p>{{ paragraph|raw }}</p>
						{% endfor %}
						</dd>
						</dl>
						</div>
					{% endif %}
					</div>
				{% endif %}
			{% endfor %}
			{% endif %} {# end fieldset.disposition #}
			{%- if fieldset.display is not empty and fieldset.display == 'pop-in' -%}
			{{ _self.popinfooter(context) }}
			{%- endif -%}
			</{%- if blocks > 1 and fieldset.hasInputFields -%}fieldset{% else %}div{% endif %}>
			{% endif %} {# end fieldset.displayable #}
		{%- elseif blck.class == 'BlockInfo' -%}
			{% set blockinfo = blck %}
			{%- if blockinfo.displayable or (step.dynamic and context.script == 1) or (simu.dynamic and step.id == 0) -%}
			<div id="{{ step.name }}-panel-{{ panel.id }}-blockinfo-{{ blockinfo.id }}" class="blockinfo-container">
				<div class="blockinfo-label">
				<h2>{{ blockinfo.label }}</h2>
				</div>
				<div class="blockinfo-chapters">
					{% for chapter in blockinfo.chapters %}
					{%- if chapter.displayable or (step.dynamic and context.script == 1) or (simu.dynamic and step.id == 0) -%}
					<div id="{{ step.name }}-panel-{{ panel.id }}-blockinfo-{{ blockinfo.id }}-chapter-{{ chapter.id }}" class="chapter-container {{ chapterContainerClass }}" data-chapter-id="{{ chapter.id }}">
						<div class="chapter-label {{ chapterHeadingClass }}">
							<h3>
								{%- if chapter.collapsible -%}
								<button id="ui-collapse-{{ step.name }}-panel-{{ panel.id }}-blockinfo-{{ blockinfo.id }}-chapter-{{ chapter.id }}" role="button" aria-expanded="false" class="btn btn-collapse" data-toggle="collapse" type="button" data-target="#{{ step.name }}-panel-{{ panel.id }}-blockinfo-{{ blockinfo.id }}-chapter-{{ chapter.id }}-sections"><span>
								{% endif %}
								{{ chapter.label }}
								{%- if chapter.collapsible -%}
								</span></button>
								{% endif %}
							</h3>
						</div>
						<div id="{{ step.name }}-panel-{{ panel.id }}-blockinfo-{{ blockinfo.id }}-chapter-{{ chapter.id }}-sections" class="blockinfo-chapter-sections {{ chapterContentClass }}{%- if chapter.collapsible %} collapse{%- endif -%}">
							{% for section in chapter.sections %}
							{%- if section.displayable or (step.dynamic and context.script == 1) or (simu.dynamic and step.id == 0) -%}
							<div id="{{ step.name }}-panel-{{ panel.id }}-blockinfo-{{ blockinfo.id }}-chapter-{{ chapter.id }}-section-{{ section.id }}" class="section-container">
								{%- if section.label is not empty -%}
								<div class="section-label">
									<h2>{{ section.label }}</h2>
								</div>
								{% endif %}
								<div class="section-body-container">
									{%- if section.annotations is not empty %}
									<div id="{{ step.name }}-panel-{{ panel.id }}-blockinfo-{{ blockinfo.id }}-chapter-{{ chapter.id }}-section-{{ chapter.id }}-annotations" class="section-annotations">
										{{ _self.paragraphs(section.annotations|raw) }}
									</div>
									{% endif %}
									<div id="{{ step.name }}-panel-{{ panel.id }}-blockinfo-{{ blockinfo.id }}-chapter-{{ chapter.id }}-section-{{ chapter.id }}-content" class="section-content{%- if section.annotations is not empty %} with-annotations{%- endif -%}">
										{{ _self.paragraphs(section.content|raw) }}
									</div>
								</div>
							</div>
							{% endif %}
							{% endfor %}
						</div>
					</div>
					{% endif %}
					{% endfor %}
				</div>
			</div>
			{%- endif -%}
		{%- endif -%}
	{% endfor %} {# end for blck in panel.fieldSets #}
	</div>
{% endfor %} {# end for panel in step.fieldSets #}
{% if panels > 1 %}
</div>
{% endif %}
{%- if simu.error or simu.warning (step.dynamic and context.script == 1) or (simu.dynamic and step.id == 0) -%}
<div id="global-error" class="{%- if simu.error %} has-error{%- elseif simu.warning %} has-warning{%- else %} hidden{%- endif -%}" aria-live="assertive">
{%- if simu.error -%}
{%- for errorMessage in simu.errorMessages -%}<p>{{ errorMessage }}</p>{%- endfor -%}
{% endif %}
{%- if simu.warning -%}
{%- for warningMessage in simu.warningMessages -%}<p>{{ warningMessage }}</p>{%- endfor -%}
{% endif %}
</div>
{% endif %}
{%- if step.footNotes and step.footNotes.position == "beforeActions" %}
{{ _self.footnotes(context) }}
{% endif %}

{{ _self.actions(context) }}

{%- if step.footNotes and step.footNotes.position == "afterActions" %}
{{ _self.footnotes(context) }}
{% endif %}

{{ _self.hiddens(context) }}

{% endmacro %}

{% macro profiles(context) %}
{% set step = context.step %}
{% if step.simulator.profiles is not empty and (step.id == 0 or step.id == 1) %}
<div class="simulator-profiles">
	<p>{{ step.simulator.profiles.label }}</p>
	<ul class="nav nav-pills">
		{% for p in step.simulator.profiles.profiles %}
		<li tabindex="0" data-profile-id="{{ p.id }}">{{ p.label }}</li>
		{% endfor %}
	</ul>
</div>
{% endif %}
{% endmacro %}

{% macro breadcrumb(context) %}

{% set step = context.step %}
{% if step.id > 0 %}
{% set simu = step.simulator %}
{% set steps = 0 %}
{%- for s in simu.steps -%}
	{% if s.id > 0 and s.displayable and (s.output is empty or s.output == 'normal') %}
		{% set steps = steps + 1 %}
	{% endif %}
{% endfor %}

{% set stepnum = 0 %}

<div class="simulator-breadcrumb">
<ol class="simulator-breadcrumb-{{ steps }} simulator-breadcrumb-{{ steps }}-{{ step.id }}">
{%- for s in simu.steps -%}
	{% if s.id > 0 and s.displayable and (s.output is empty or s.output == 'normal') %} 
		{% set stepnum = stepnum + 1 %}
		{% if s.id == step.id %}
		<li class="current" title="{{ 'Current step'|trans }}"><p><span>{{ stepnum }}</span> <span>{{ s.label }}</span></p></li>
		{% else %}
		<li><p><span>{{ stepnum }}</span> <span>{{ s.label }}</span></p></li>
		{% endif %}
	{% endif %}
{% endfor %}
</ol>
</div>
{% endif %}

{% endmacro %}

{% macro popinheader(context, fieldset) %}
<a data-toggle="modal" data-target="#popin-{{ context.step.id ~ '-' ~ fieldset.id }}">{{ fieldset.popinLink }}</a>
<div class="modal fade" id="popin-{{ context.step.id ~ '-' ~ fieldset.id }}" tabindex="-1" role="dialog" aria-labelledby="popin-{{ context.step.id ~ '-' ~ fieldset.id }}-label">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Fermer"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="popin-{{ context.step.id ~ '-' ~ fieldset.id }}-label">{{ fieldset.legend }}</h4>
			</div>
			<div class="modal-body">
{% endmacro %}

{% macro popinfooter(context) %}
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
			</div>
		</div>
	</div>
</div>
{% endmacro %}

{% macro actions(context) %}

{% set step = context.step %}
{% set simu = step.simulator %}
<div class="action_buttons">

{%- for action in step.actions -%}
	 <button class="btn {{ action.class }}" type="{{ action.what }}" name="{{ action.name }}">{% if action.for == 'priorStep' %}<span class="glyphicon glyphicon-menu-left"> </span>{% endif %}{{ action.label }}{%if action.for == 'nextStep' %}<span class="glyphicon glyphicon-menu-right"> </span>{% endif %}</button>
{% endfor %}

</div>
{% endmacro %}

{% macro footnotes(context) %}
{% set step = context.step %}
{%- if step.footNotes and (step.footNotes.displayable or (step.dynamic and context.script == 1) or (step.simulator.dynamic and step.id == 0)) %}
{% set footnotes = step.footNotes %}
<div class="foot-notes">
{%- for footnote in footnotes.footNotes -%}
	{%- if footnote.displayable or (step.simulator.dynamic and step.id == 0) or (step.dynamic and context.script == 1) -%}
	<div id="foot-note-{{ footnote.id }}" class="foot-note">
	{{ footnote.text|raw }}
	</div>
	{% endif %}
{% endfor %}
</div>
{% endif %}
{% endmacro %}

{% macro hiddens(context) %}
{% set step = context.step %}
{% set extras = context.hiddens %}
{% set simu = step.simulator %}
{%- for data in simu.datas -%}
	{%- if data.class == "DataGroup" -%}
	{%- for gdata in data.datas -%}
	{%- if not gdata.used -%}
		<input type="hidden" name="{{ gdata.name }}" value="{{ gdata.plainValue }}"{%- if gdata.inputStepId == 0 or gdata.inputStepId > step.id %} class="resettable"{%- endif -%} />
	{% endif %}
	{% endfor %}
	{%- elseif not data.used -%}
		<input type="hidden" name="{{ data.name }}" value="{{ data.plainValue }}"{%- if data.inputStepId == 0 or data.inputStepId > step.id %} class="resettable"{%- endif -%} />
	{% endif %}
{% endfor %}
{%- for name, value in extras -%}
	<input type="hidden" name="{{ name }}" value="{{ value }}" />
{% endfor %}
<input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}" />
{% endmacro %}

{% macro monthname(m) %}
{% set months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"] %}
{% if m > 0 %}{{ months[m - 1] }}{% endif %}
{% endmacro %}

{% macro paragraphs(text) %}
	{% set paragraphs = text|trim|split("\n") %}
	{%- for paragraph in paragraphs -%}
	<p>{%- if paragraph|trim is empty -%}&nbsp;{%- else -%}{{ paragraph|raw }}{%- endif -%}</p>
	{% endfor %}
{% endmacro %}

{% macro departments(value, prompt) %}
{% set deps = {'01': 'Ain', '02': 'Aisne', '03': 'Allier', '04': 'Alpes-de-Haute-Provence', '05': 'Hautes-Alpes', '06': 'Alpes-Maritimes', '07': 'Ardèche', '08': 'Ardennes', '09': 'Ariège', '10': 'Aube', '11': 'Aude', '12': 'Aveyron', '13': 'Bouches-du-Rhône', '14': 'Calvados', '15': 'Cantal', '16': 'Charente', '17': 'Charente-Maritime', '18': 'Cher', '19': 'Corrèze', '21': 'Côte-d\'Or', '22': 'Côtes-d\'Armor', '23': 'Creuse', '24': 'Dordogne', '25': 'Doubs', '26': 'Drôme', '27': 'Eure', '28': 'Eure-et-Loir', '29': 'Finistère', '2A': 'Corse-du-Sud', '2B': 'Haute-Corse', '30': 'Gard', '31': 'Haute-Garonne', '32': 'Gers', '33': 'Gironde', '34': 'Hérault', '35': 'Ille-et-Vilaine', '36': 'Indre', '37': 'Indre-et-Loire', '38': 'Isère', '39': 'Jura', '40': 'Landes', '41': 'Loir-et-Cher', '42': 'Loire', '43': 'Haute-Loire', '44': 'Loire-Atlantique', '45': 'Loiret', '46': 'Lot', '47': 'Lot-et-Garonne', '48': 'Lozère', '49': 'Maine-et-Loire', '50': 'Manche', '51': 'Marne', '52': 'Haute-Marne', '53': 'Mayenne', '54': 'Meurthe-et-Moselle', '55': 'Meuse', '56': 'Morbihan', '57': 'Moselle', '58': 'Nièvre', '59': 'Nord', '60': 'Oise', '61': 'Orne', '62': 'Pas-de-Calais', '63': 'Puy-de-Dôme', '64': 'Pyrénées-Atlantiques', '65': 'Hautes-Pyrénées', '66': 'Pyrénées-Orientales', '67': 'Bas-Rhin', '68': 'Haut-Rhin', '69': 'Rhône', '70': 'Haute-Saône', '71': 'Saône-et-Loire', '72': 'Sarthe', '73': 'Savoie', '74': 'Haute-Savoie', '75': 'Paris', '76': 'Seine-Maritime', '77': 'Seine-et-Marne', '78': 'Yvelines', '79': 'Deux-Sèvres', '80': 'Somme', '81': 'Tarn', '82': 'Tarn-et-Garonne', '83': 'Var', '84': 'Vaucluse', '85': 'Vendée', '86': 'Vienne', '87': 'Haute-Vienne', '88': 'Vosges', '89': 'Yonne', '90': 'Territoire de Belfort', '91': 'Essonne', '92': 'Hauts-de-Seine', '93': 'Seine-Saint-Denis', '94': 'Val-de-Marne', '95': 'Val-d\'Oise', '971': 'Guadeloupe', '972': 'Martinique', '973': 'Guyane', '974': 'La Réunion', '976': 'Mayotte'} %}
<option value=""{%- if value == "" %} selected="selected"{% endif %}>{{ prompt }}</option>
{%- for nodep, dep in deps -%}
<option value="{{ nodep }}"{%- if nodep == value %} selected="selected"{% endif %}>{{ nodep }} - {{ dep }}</option>
{% endfor %}
{% endmacro %}

{% macro departmentname(nodep) %}
{% set deps = {'01': 'Ain', '02': 'Aisne', '03': 'Allier', '04': 'Alpes-de-Haute-Provence', '05': 'Hautes-Alpes', '06': 'Alpes-Maritimes', '07': 'Ardèche', '08': 'Ardennes', '09': 'Ariège', '10': 'Aube', '11': 'Aude', '12': 'Aveyron', '13': 'Bouches-du-Rhône', '14': 'Calvados', '15': 'Cantal', '16': 'Charente', '17': 'Charente-Maritime', '18': 'Cher', '19': 'Corrèze', '21': 'Côte-d\'Or', '22': 'Côtes-d\'Armor', '23': 'Creuse', '24': 'Dordogne', '25': 'Doubs', '26': 'Drôme', '27': 'Eure', '28': 'Eure-et-Loir', '29': 'Finistère', '2A': 'Corse-du-Sud', '2B': 'Haute-Corse', '30': 'Gard', '31': 'Haute-Garonne', '32': 'Gers', '33': 'Gironde', '34': 'Hérault', '35': 'Ille-et-Vilaine', '36': 'Indre', '37': 'Indre-et-Loire', '38': 'Isère', '39': 'Jura', '40': 'Landes', '41': 'Loir-et-Cher', '42': 'Loire', '43': 'Haute-Loire', '44': 'Loire-Atlantique', '45': 'Loiret', '46': 'Lot', '47': 'Lot-et-Garonne', '48': 'Lozère', '49': 'Maine-et-Loire', '50': 'Manche', '51': 'Marne', '52': 'Haute-Marne', '53': 'Mayenne', '54': 'Meurthe-et-Moselle', '55': 'Meuse', '56': 'Morbihan', '57': 'Moselle', '58': 'Nièvre', '59': 'Nord', '60': 'Oise', '61': 'Orne', '62': 'Pas-de-Calais', '63': 'Puy-de-Dôme', '64': 'Pyrénées-Atlantiques', '65': 'Hautes-Pyrénées', '66': 'Pyrénées-Orientales', '67': 'Bas-Rhin', '68': 'Haut-Rhin', '69': 'Rhône', '70': 'Haute-Saône', '71': 'Saône-et-Loire', '72': 'Sarthe', '73': 'Savoie', '74': 'Haute-Savoie', '75': 'Paris', '76': 'Seine-Maritime', '77': 'Seine-et-Marne', '78': 'Yvelines', '79': 'Deux-Sèvres', '80': 'Somme', '81': 'Tarn', '82': 'Tarn-et-Garonne', '83': 'Var', '84': 'Vaucluse', '85': 'Vendée', '86': 'Vienne', '87': 'Haute-Vienne', '88': 'Vosges', '89': 'Yonne', '90': 'Territoire de Belfort', '91': 'Essonne', '92': 'Hauts-de-Seine', '93': 'Seine-Saint-Denis', '94': 'Val-de-Marne', '95': 'Val-d\'Oise', '971': 'Guadeloupe', '972': 'Martinique', '973': 'Guyane', '974': 'La Réunion', '976': 'Mayotte'} %}
{{ deps[nodep] }}
{% endmacro %}

{% macro asset(c, resource) %}{% set pathlength = c.pathlength %}{% set updir = 'src/EUREKA/G6KBundle/Resources/public/' ~ resource %}{%- if pathlength > 0 %}{% for i in 1..pathlength %}{% set updir = '../' ~ updir %}{% endfor %}{% endif %}{{ updir }}{% endmacro %}
